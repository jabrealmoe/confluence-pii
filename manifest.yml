modules:
  trigger:
    - key: confluence-pii-trigger
      function: main
      events:
        - avi:confluence:created:page
        - avi:confluence:updated:page
  function:
    - key: main
      handler: index.run
    - key: pii-admin-resolver
      handler: resolver.handler
    - key: pii-byline-resolver
      handler: byline-resolver.handler
  confluence:globalSettings:
    - key: pii-admin-settings-v3
      resource: admin-resource
      resolver:
        function: pii-admin-resolver
      title: PII Configuration
  confluence:contentBylineItem:
    - key: pii-status-indicator
      resource: byline-resource
      resolver:
        function: pii-byline-resolver
      title: PII Shield
resources:
  - key: admin-resource
    path: static/admin-build
  - key: byline-resource
    path: static/byline-build
app:
  runtime:
    name: nodejs22.x
    memoryMB: 256
    architecture: arm64
  id: ari:cloud:ecosystem::app/d4615e62-0837-4e1f-9fd8-02e2dea232ab
permissions:
  scopes:
    # Page operations - read and modify pages
    - read:page:confluence
    - write:page:confluence

    # Content operations - required for triggers and labeling
    - read:confluence-content.all
    - read:confluence-content.summary # Required for page created/updated triggers
    - write:confluence-content # Required for adding labels to pages

    # Search and user operations
    - search:confluence
    - read:confluence-user
    - read:space:confluence

    # App storage
    - storage:app
